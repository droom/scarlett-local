{% include '__has-variables' %}
{% capture vars %}
{% if product.featured_image == blank %}
{% include '__image-placeholder' %}
{% else %}
{% capture image %}
{% if settings.round-thumbnail-images and template != 'index' %}{% assign round-class = 'img-circle' %}{% endif %}
<img id="main" class="{{ round-class }}" src="{{ product.featured_image.src | product_img_url: 'grande' }}" alt="{{ product.featured_image.alt }}" itemprop="image">
{% endcapture %}
{% endif %}
{% endcapture %}
<section id="product-wrap" class="section-wrap">
	<div class="visible-xs">
		<small class="product-section">
			<strong>{{ collection.title | upcase }}</strong> &mdash; {{ collection.description }}
		</small>
		<h1 class="page-header" itemprop="name">{{ page_title }}</h1>
	</div>
	<form id="product-form" action="/cart/add" method="post" role="form">
		<div class="row" itemscope itemtype="http://data-vocabulary.org/Product">
			<!-- images col -->
			<div class="col-sm-8 {% if settings.product-page-image-placement == 'right' %}col-sm-push-4{% endif %}">
				<div class="row">
					<div class="col-xs-12 col-sm-12 centreCopy" >

						<div class="thumbnail product-main-image">
							<div class="productHero-feature">
								<img src="{{ product.featured_image | product_img_url: "original" }}" />
							</div>
							
							<div class="productHero-360">
								<div class="spritespin360">
									


								</div>
							</div>

							<div class="productHero-life">
								<div id="imageStack">
									{% for image in product.images %}
									{% if image contains '_Life_' %}
									<img class="lifecycleImage" src="{{ image.src | product_img_url: 'original' }}" data-index="{{ forloop.index }}" />
									{% endif %} 
									{% endfor %}
								</div>
							</div>
						</div> 

						<p>Views: 
							<a href="javascript:void(0);" class="productSwitch productSwitch-feature">Image
							</a> 


							|
							<a href="javascript:void(0);" class="productSwitch productSwitch-360">360Â°
							</a>


							{% for image in product.images %}
							{% if image contains '_Life_01' %}
							| 
							<a href="javascript:void(0);" class="productSwitch productSwitch-life">Model
							</a>
							{% endif %} 
							{% endfor %}
						</p>
					</div>

				</div>
			</div> 


			<div class="col-sm-4 {% if settings.product-page-image-placement == 'right' %}col-sm-pull-8{% endif %}">

				<small class="product-section hidden-xs"><strong>{{ collection.title | upcase }}</strong> | {{ collection.description }}</small>
				
				<h1 class="hidden-xs" itemprop="name">{{ page_title }}</h1>

				<!-- {% if has_prices %} -->

				{% include '__cart-social' %}

				<div class="product-price" itemprop="offerDetails" itemscope itemtype="http://data-vocabulary.org/Offer">

					<del id="compare-at-price-field" class="text-muted"></del>
					<span id="sale-field" class="label label-success" style="display: none;">{% include '__localize' with 'On sale' %}</span>
					<meta itemprop="currency" content="{{ shop.currency }}" />
					<meta itemprop="identifier" content="sku:{{ product.variants.first.sku }}" />
				</div>
				{% endif %}
				<p itemprop="description">{% include '__formatted-content' with product.description %}</p>

				{% if has_cart %}{% include 'product-add-to-cart-form' %}{% endif %}

				<div class="centreCopy">
					<p><a href="https://sos-test-2.myshopify.com/pages/take-us-for-a-spin">What are Home Try-Ons?</a><br />3-5 Business Days Shipping | Free Shipping | Free Returns</p>
				</div>	

			</div>


			<div class="hallmarks col-sm-12 {% if settings.product-page-image-placement == 'right' %}col-sm-push-0{% endif %}">
				<h3>Scarlett of Soho Design Hallmarks</h3>
				<p>Explore the little details that distinguish our frames from the rest of the pack</p>
			</div>
			<div class="center col-sm-6 {% if settings.product-page-image-placement == 'right' %}col-sm-push-6{% endif %}">
				{% for image in product.images %}
				{% if image contains '_Info_01' %}
				<img src="{{ image.src | product_img_url: 'original' }}" />
				{% endif %} 
				{% endfor %}
			</div>
			<div class="center col-sm-6 {% if settings.product-page-image-placement == 'right' %}col-sm-push-6{% endif %}">
				{% for image in product.images %}
				{% if image contains '_Info_02' %}
				<img src="{{ image.src | product_img_url: 'original' }}" />
				{% endif %} 
				{% endfor %}
			</div>
			<div class="center hidden-xs col-sm-12 {% if settings.product-page-image-placement == 'right' %}col-sm-push-0{% endif %}">
				{% for image in product.images %}
				{% if image contains '_Info_03' %}
				<img src="{{ image.src | product_img_url: 'original' }}" />
				{% endif %} 
				{% endfor %}
			</div>
		</div>
	</form>
</section>







{% for image in product.images %}
{% if image contains '_Life_' %}
<p class="spinLife">{{ image.src | product_img_url: 'original' }}</p>
{% endif %} 
{% endfor %}



{% for image in product.images %}
{% if image contains '_360_' %}
<p class="spin360">{{ image.src | product_img_url: 'original' }}</p>
{% endif %} 
{% endfor %}





<div> 
	<script>

		$( document ).ready(function() {


			var listItems = $('.spin360');
			var listItemsLength = listItems.length;
			var listString = ($.trim(listItems[0].innerHTML));
			var position360 = listString.indexOf("360");

			var url_part1 = listString.slice(0, position360+4);
			var url_part2 = listString.slice(position360+4, position360+6);
			var url_part3 = listString.slice(position360+6, listString.length);


			var listItemsLife = $('.spinLife');
			var listItemsLifeLength = listItemsLife.length;
			var listStringLife = ($.trim(listItemsLife[0].innerHTML));
			var positionLife = listStringLife.indexOf("Life");

			var url_Life_part1 = listStringLife.slice(0, positionLife+5);
			var url_Life_part2 = listStringLife.slice(positionLife+5, positionLife+7);
			var url_Life_part3 = listStringLife.slice(positionLife+7, listStringLife.length);


			console.log("url_Life_part3 is "+url_Life_part3);




			$('.spritespin360').spritespin({
				source: SpriteSpin.sourceArray(url_part1+'{frame}'+url_part3, { frame: [01,listItemsLength], digits: 2 }),
				width: 553,
				height: 315,
				sense: -1,
				renderer: 'image'
			});
			console.log("listItemsLifeLength: " + listItemsLifeLength);




			$("#imageStack img:nth-child(3)").show();

			$("#imageStack").mousemove(function(e){
				var parentOffset = $(this).parent().offset(); 
				var relX = e.pageX - parentOffset.left;
				var tWidth = $(this).width();  
				var pos = (relX/tWidth) * 100;

				$('.lifecycleImage').hide();
				switch(true){
					case (pos < 20):
					// $("#imageStack").children("img[data-index=" + 6 + "]").show();
					$("#imageStack img:nth-child(5)").show();
					break;

					case (pos < 40):
					
					// $("#imageStack").children("img[data-index=" + 5 + "]").show();
					$("#imageStack img:nth-child(4)").show();
					break;

					case (pos < 60):
					
					// $("#imageStack").children("img[data-index=" + 4 + "]").show();
					$("#imageStack img:nth-child(3)").show();
					break;

					case (pos < 80):
					
					// $("#imageStack").children("img[data-index=" + 3 + "]").show();
					$("#imageStack img:nth-child(2)").show();
					break;

					case (pos < 100):
					
					// $("#imageStack").children("img[data-index=" + 2 + "]").show();
					$("#imageStack img:nth-child(1)").show();
					break;
				}
			});





			// full 553x315
			// 432 x 370



			( function( $ ) {
				$( 'a[href="#"]' ).click( function(e) {
					e.preventDefault();
				} );
			} );




			var anchors_and_divs = {
				'.productSwitch-360'     :  '.productHero-360',
				'.productSwitch-life'    :  '.productHero-life',
				".productSwitch-feature" :  '.productHero-feature'
			}

			function hide_rest(element_to_show) {
				$(element_to_show).click(function(){
					// console.log(element_to_show);
					var div_to_show = anchors_and_divs[element_to_show];
					$('.productHero-feature').hide();
					$('.productHero-360').hide();
					$('.productHero-life').hide();
					$(div_to_show).show();
				});
			}

			hide_rest('.productSwitch-360' );
			hide_rest('.productSwitch-life' );
			hide_rest('.productSwitch-feature' );


			var selectCallback = function(variant, selector){
			// set vars so we dont need to call the elements repeatedly
			var purchaseButton = jQuery(document.getElementById('purchase'));
			var priceField = jQuery(document.getElementById('price-field'));
			var saleField = jQuery(document.getElementById('sale-field'));
			var compareAtPriceField = jQuery(document.getElementById('compare-at-price-field'));

			var unavailableStr = '{% include '__localize' with 'Unavailable' %}';
			var addToCartStr = '{% include '__localize' with 'Add to cart' %}';
			var soldOutStr = '{% include '__localize' with 'Sold out' %}';

			// disable purchase button
			purchaseButton.removeClass('btn-primary').addClass('disabled').attr('disabled', 'disabled').val(unavailableStr);
			priceField.addClass('text-muted');
			saleField.hide();
			compareAtPriceField.html('').hide();

			if(variant){
			  // we have a variant so update the price
			  var moneyFormat = "{% if settings.show-currency-with-prices %}{{ shop.money_with_currency_format }}{% else %}{{ shop.money_format }}{% endif %}"; // we still need the correct money format if the currency converter is off
			  var formattedMoney = Shopify.formatMoney(variant.price, moneyFormat); 
			  priceField.html('<span class="money">'+formattedMoney+'</span>'); // we need to refresh the the money span to invoke the currency converter if it is on
			  
			  if(variant.compare_at_price > 0){
			    // variant is on sale
			    var compareAtFormattedMoney = Shopify.formatMoney(variant.compare_at_price, moneyFormat); 
			    compareAtPriceField.html('<span class="money">'+compareAtFormattedMoney+'</span>').show();
			    saleField.show();
			}

			if(variant.available){
			    // the variant is available for purchase so enable the button
			    purchaseButton.removeAttr('disabled').removeClass('disabled').addClass('btn-primary').val(addToCartStr);
			    priceField.removeClass('text-muted');
			} else {
			    // sold out
			    purchaseButton.val(soldOutStr);
			}


			$("input[value='Try it']").click(function(e){
				$("input[value='Try it']").parents('form').attr('id', "add-item-form");
				$("input[value='Add to cart']").parents('form').attr('id', "add-item-form-100");
			});

			$("input[value='Add to cart']").click(function(e){
				$("input[value='Try it']").parents('form').attr('id', "add-item-form-100");
				$("input[value='Add to cart']").parents('form').attr('id', "add-item-form");
			});

		}
	}


});



</script>
